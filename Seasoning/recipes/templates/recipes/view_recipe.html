{% extends "base.html" %}
{% load compressed %}
{% load markdown_filter %}

{% block meta_description %}{{ recipe.description }}{% endblock %}

{% block title %}{{ recipe.name }}{% endblock %}

{% block extra_script %}
	<script src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
	<script src="{{ STATIC_URL }}js/plugins/jssor_slider/jssor.slider.mini.js"></script>
	<script src="{{ STATIC_URL }}js/ingredient_availability.js"></script>
	<script src="{{ STATIC_URL }}js/highcharts.js"></script>
	<script type="text/javascript"> 
	   var recipe_id = {{ recipe.id }};
	   var upvote_url = "{% url 'upvote_recipe' recipe.id %}";
	   var downvote_url = "{% url 'downvote_recipe' recipe.id %}";
	   var orig_recipe_portions = {{ recipe.portions }}
	   var recipe_portions_url = "{% url 'ajax_recipe_ingredients' recipe.id "0000" %}"
	   var ingredients_avail_ajax_url = "{% url 'ajax_ingredient_availability' %}";
	   var static_url = {{ STATIC_URL }};
	</script>
	<script src="{{ STATIC_URL }}js/view_recipe.js"></script>
	<link href='https://fonts.googleapis.com/css?family=Lobster+Two' rel='stylesheet' type='text/css'>
{% endblock %}

{% block before-content %}{% endblock %}

{% block content %}

{% block messages %}{% endblock %}

<div id="recipe-header-container" class="row">
	<div id="recipe-header" class="col-xs-12">
		<div id="recipe-header-top" class="recipe-image-overlay row">
			<div id="recipe-name-info" class="col-xs-12 text-center">
				<h1>{{ recipe.name }}</h1>
				<span id="add-info">
				    	{% if recipe.external %}
				    	<span id="author">Recept van <a href="{{ recipe.external_site.url }}" target="_blank">{{ recipe.external_site.name }}</a></span>
				    	{% else %}
				        <span id="author">Toegevoegd door <a href="{% url 'user_profile' recipe.author.id %}">{{ recipe.author.get_full_name }}</a></span><br />
				        {% endif %}
				</span>
			</div>
				
			{% if recipe.author == user or user.is_staff %}
			<div id="recipe-actions" class="dropdown">
				<button class="btn btn-default dropdown-toggle pull-right" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
			    	Opties
			    	<span class="caret"></span>
				</button>
			  	<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">
			    	<li role="presentation">
			    		{% if recipe.incomplete_class %}
				    	<a role="menuitem" tabindex="-1" href="{% url 'edit_incomplete_recipe' recipe.id %}" title="Wijzig dit recept">Recept Wijzigen</a>
				   		{% else %}
				    	<a role="menuitem" tabindex="-1" href="{% url 'edit_recipe' recipe.id %}" title="Wijzig dit recept">Recept Wijzigen</a>
				    	{% endif %}
				    </li>
				    <li role="presentation">
				    	<a role="menuitem" tabindex="-1"
				    	   href="{% url 'delete_recipe' recipe.id %}" 
			               title="Verwijder dit recept" 
			               onclick="return confirm('Weet u zeker dat u dit recept wil verwijderen?')">Recept Verwijderen</a>
				    </li>
			  	</ul>
			</div>
		    {% endif %}
		</div>
		
		{% if messages %}
	    <div id="recipe-messages">
		    <ul class="messages">
			   	{% for message in messages %}
		        <li class="{{ message.tags }}">
		         	{{ message }}
		        </li>
		        {% endfor %}
			</ul>
		</div>
		{% endif %}
	    
		<div class="row">
	        	 
		    <form id="upload-image-form" action="" method="POST" enctype="multipart/form-data">
				{% csrf_token %}
				{{ upload_image_form.image }}
		 	</form>
		
			<div id="recipe-images-carousel" class="carousel slide" 
				 data-ride="carousel"
			 	 data-interval="false">
		  
		    	<!-- Indicators -->
		  		<ol class="carousel-indicators">
		  			{% for image in recipe.images.all %}
		  			<li data-target="#recipe-images-carousel" 
		  			    data-slide-to="{{ forloop.counter0 }}" 
		  			    {% if forloop.first %}class="active"{% endif %}>
		  				
		  				<span style="position:relative;">
			                {% if image.added_by == user or recipe.author == user or user.is_staff %}
			                <a class="remove-image-button" href="{% url 'delete_recipe_image' image.id %}" title="Verwijder deze afbeelding"><img src="{{ STATIC_URL }}img/icons/delete.png" alt="" /></a>
			                {% endif %}
		                	<img class="slide-thumb" src="{{ image.thumbnail.url }}" />
		                </span>
		  			</li>
		  			{% endfor %}
		  			<li onclick="$('#upload-image-form input#id_image').click();return false;"
		  				title="Voeg een nieuwe afbeelding toe">
		  				<span style="position:relative;">
			                <img class="slide-thumb" src="{{ STATIC_URL }}img/decoration/add_image.png" />
		                </span>
		  			</li>
		  		</ol>
		
		  		<!-- Wrapper for slides -->
		  		<div class="carousel-inner" role="listbox">
		  			{% for image in recipe.images.all %}
		  			<div class="item{% if forloop.first %} active{% endif %}" style="background-image: url('{{ image.image.url }}');">
		    		</div>
		            {% empty %}	
		  			<div class="item{% if forloop.first %} active{% endif %}" style="background-image: url('{{ MEDIA_URL }}images/recipes/no-image.png');">
		    		</div>	            
		            {% endfor %}
		            
		  		</div>
		
		  		<!-- Controls -->
		  		<a class="left carousel-control" href="#recipe-images-carousel" role="button" data-slide="prev">
		    		<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
		    		<span class="sr-only">Previous</span>
		  		</a>
		  		<a class="right carousel-control" href="#recipe-images-carousel" role="button" data-slide="next">
		    		<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
		    		<span class="sr-only">Next</span>
		  		</a>
			</div>
		</div>
			
		<div id="graphic-information" class="recipe-image-overlay row" style="clear: both;">
				<div id="veganism" class="graphic-information-icon">
					{% if recipe.veganism == 2 %}
			    	<img src="{{ STATIC_URL }}img/icons/vegan.png" title="Dit is een veganistisch recept" alt="" />
			        {% elif recipe.veganism == 1 %}
			    	<img src="{{ STATIC_URL }}img/icons/vegetarian.png" title="Dit is een vegetarisch recept" alt="" />
			        {% elif recipe.veganism == 0 %}
			    	<img src="{{ STATIC_URL }}img/icons/non-vegetarian.png" title="Dit is een niet-vegetarisch recept" alt="" />
			    	{% endif %}
			    </div>
				<div id="fp-category" class="graphic-information-icon">
					<span class="positioner">
						<img src="{{ STATIC_URL }}img/decoration/{{ recipe.fp_category.get_ribbon_image_name }}" 
						     title="{{ recipe.fp_category.extra_info }}"/>
					</span>
				</div>
				<div id="recipe-footprint" class="graphic-information-icon">
					<span id="recipe-footprint-text" class="text-overlay" 
					      title="Dit recept heeft een voetafdruk van {{ recipe.footprint|floatformat:2 }} kgCO&#8322; per portie.">
					      	{{ recipe.footprint|floatformat:2 }}
					      	<span style="display: block;font-size:16px">kgCO₂ p.p.</span>
					</span>
				</div>
				<div id="recipe-duration" class="graphic-information-icon">
					<img src="{{ STATIC_URL }}img/decoration/clock.png" />
					<span id="recipe-footprint-text" class="text-overlay" 
					      title="Dit recept duurt {{ recipe.total_preparation_time }} minuten om klaar te maken (waarvan je {{ recipe.active_time }} minuten actief bezig zal zijn).">
					      {{ recipe.total_preparation_time }}
					      <span style="display: block;font-size:18px;line-height:15px;">min</span>
					</span>
				</div>
				<div id="recipe-upvotes" class="graphic-information-icon">
					<div style="position: relative; display: inline-block; width: 60px; height: 100%;">
						<div id="upvote-count" class="upvote-bubble">{{ recipe.upvotes }}</div>
						{% if user.is_authenticated %}
						<a id="upvote-button" href="#" onclick="upvote();return false;"{% if user_has_upvoted %} style="display: none;"{% endif %}><img src="{{ STATIC_URL }}img/icons/lekker.png" style="position: absolute; left: 0; bottom: 0; width: 60px; height: auto; opacity: 0.5;"/></a>
						<a id="downvote-button" href="#" onclick="downvote();return false;"{% if not user_has_upvoted %} style="display: none;"{% endif %}><img src="{{ STATIC_URL }}img/icons/lekker.png" style="position: absolute; left: 0; bottom: 0; width: 60px; height: auto;"/></a>
						{% else %}
						<a id="upvote-button" href="{% url 'login' %}?next={{ request.get_full_path }}"><img src="{{ STATIC_URL }}img/icons/lekker.png" style="position: absolute; left: 0; bottom: 0; width: 60px; height: auto;"/></a>
						{% endif %}
					</div>
				</div>
				<br class="clear" />
			</div>
		</div>
	</div>
	
	<div id="basic-information" class="container">
		<h4>
			{% if recipe.cuisine %}
		    <span itemprop="recipeCuisine">{{ recipe.cuisine }}</span>{% if recipe.course == 4 or recipe.course == 6 or recipe.course == 8 or recipe.course == 9 %}e{% endif %} 
		    <span itemprop="recipeCategory">{{ recipe.get_course_display|lower }}</span>
		    {% else %}
		    <span itemprop="recipeCategory">{{ recipe.get_course_display }}</span>
		    {% endif %}
	    </h4>
	    
	    <p>
	    	{{ recipe.description }}
	    </p>
	</div>
                
    <h2>
      	<span>Ingrediënten</span>
	</h2>
	
    <div>  	
       	<div id="portions-changer">
       		<h3>Porties</h3>
       		<span id="portions-changer-input">
       			<input id="portions-spinner" type="text" value={{ recipe.portions }} />
       		</span>
       		<br class="clear" />
       	</div>
	</div>
	   
	<div id="ingredients-wrapper" class="container">
		<div id="ingredients">
		</div>
		<div id="ingredients-darkener">
	      	<span id="ingredients-loader">
	       		{% include "includes/big-ajax-loader.html" %}
	       	</span>
       	</div>
	</div>
		        
	{% if recipe.extra_info %}
	<div id="extra-info" class="container">
		<h4>Extra info en benodigdheden</h4>
	    <div>
	       	{{ recipe.extra_info|linebreaks }}
	    </div>
	</div>
	{% endif %}
		        
		        
	<h2>
	   	<span>Bereiding</span>
	</h2>
		        
	<div id="instructions-container" class="container markdown-container">
		<div id="instructions-warning">
			Opgelet! De onderstaande instructies zijn opgesteld voor {{ recipe.portions }} porties. Je hebt het aantal porties aangepast waardoor het mogelijk
		    is dat deze instructies niet meer volledig accuraat zijn. Hou hier rekening mee.
		</div>
		{% if recipe.external %}
		<a id="external-link" href="http://www.seasoning.be{% url 'external_recipe' recipe.id %}">
		 	<button type="submit">Bekijk het volledige recept op {{ recipe.external_site.name }}</button>
		</a>
		{% else %}
		<div id="instructions" itemprop="recipeInstructions">
			{{ recipe.instructions|markdown|safe }}
		</div>
	    {% endif %}
	</div>
	        
    <h2>
    	<span>Grafieken</span>
    </h2>
                
    <div id="recipe-charts" class="container">
		<div id="chart-tabs">
	    	<ul>
	        	<li><a href="#tabs-1">Dynamiek</a></li>
	            <!-- <li><a href="#tabs-2">Verhoudingen</a></li>-->
	        </ul>
	        <div id="tabs-1">
	            <div id="recipe-fpevo-chart">            
	            	       
	            </div>
	        </div>
	        <!-- 
	        <div id="tabs-2">
	        	<div id="recipe-fprel-chart">
	                
	            </div>
	        </div>
	        -->
	    </div>
	        
		<div id="charts-ajax-loader">
		    {% include "includes/big-ajax-loader.html" %}
		</div>
	</div>

{% endblock %}
