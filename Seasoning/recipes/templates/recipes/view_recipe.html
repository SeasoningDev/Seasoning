{% extends "base.html" %}
{% load compressed %}
{% load markdown_filter %}

{% block meta_description %}{{ recipe.description }}{% endblock %}

{% block title %}{{ recipe.name }}{% endblock %}

{% block extra_style %}
{% compressed_css 'ingredients' %}
{% endblock %}

{% block extra_script %}
	<script src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
	<script src="https://raw.githubusercontent.com/jssor/slider/master/js/jssor.slider.mini.js"></script>
	<script src="{{ STATIC_URL }}js/ingredient_availability.js"></script>
	<script src="{{ STATIC_URL }}js/highcharts.js"></script>
	<script type="text/javascript"> 
	   var recipe_id = {{ recipe.id }};
	   var recipe_portions = {{ recipe.portions }}
	   var recipe_portions_url = "{% url 'ajax_recipe_ingredients' recipe.id "0000" %}"
	   var ingredients_avail_ajax_url = "{% url 'ajax_ingredient_availability' %}";
	</script>
	<script src="{{ STATIC_URL }}js/view_recipe.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
{% endblock %}


{% block content-container %}
	<div id="recipe-header-container">
		<div id="recipe-header">
			<div id="recipe-basic-info">
				<h2 id="recipe-name">{{ recipe.name }}</h2>
	    
			    <div id="add-info">
			    	{% if recipe.external %}
			    	<span id="author">Recept van <a href="{{ recipe.external_site.url }}" target="_blank">{{ recipe.external_site.name }}</a></span>
			    	{% else %}
			        <span id="author">Toegevoegd door <a href="{% url 'user_profile' recipe.author.id %}">{{ recipe.author.get_full_name }}</a></span><br />
			        <span id="time-added">{{ recipe.time_added|date:"j F Y, G" }}u{{ recipe.time_added|date:"i" }}</span>
			        {% endif %}
			    </div>
			    
			    <div id="recipe-category">
			    	{% if recipe.cuisine %}
	                	<span itemprop="recipeCuisine">{{ recipe.cuisine }}</span>{% if recipe.course == 4 or recipe.course == 6 or recipe.course == 8 or recipe.course == 9 %}e{% endif %} 
	                	<span itemprop="recipeCategory">{{ recipe.get_course_display|lower }}</span>
	                {% else %}
	                	<span itemprop="recipeCategory">{{ recipe.get_course_display }}</span>
	                {% endif %}
			    </div>
			        
			    <div id="recipe-description">
			    	{{ recipe.description }}
			    </div>
			    
			    <div id="recipe-actions">
			        {% if recipe.author == user or user.is_staff %}
			    	<a href="{% url 'delete_recipe' recipe.id %}" title="Verwijder dit recept" onclick="return confirm('Weet u zeker dat u dit recept wil verwijderen?')"><img src="{{ STATIC_URL }}img/icons/delete.png" alt="" /></a>
			        <a href="{% url 'edit_recipe' recipe.id %}" title="Wijzig dit recept"><img src="{{ STATIC_URL }}img/icons/edit.png" alt="" /></a>
			    	{% endif %}
			    	<form id="upload-image-form" action="" method="POST" enctype="multipart/form-data">
			    		{% csrf_token %}
						<div id="upload-image-button">
							<img class="icon" src="{{ STATIC_URL }}img/icons/camera.png" title="Voeg een foto toe aan dit recept" />
						</div>
						{{ upload_image_form.image }}
			    	</form>
			    </div>
			</div>
			<div id="recipe-images" style="position: relative; top: 0px; right: 0px; width: 450px;
	        	 height: 350px; background: #24262e; overflow: hidden; float: right;">
	        	 
		        <!-- Loading Screen -->
		        <div u="loading" style="position: absolute; top: 0px; left: 0px;">
		            <div style="filter: alpha(opacity=70); opacity:0.7; position: absolute; display: block;
		                background-color: #000000; top: 0px; left: 0px;width: 100%;height:100%;">
		            </div>
		            <div style="position: absolute; display: block; background: url('http://www.theratchetshop.com/skin/frontend/default/default/images/ajaxcart/loading.gif') no-repeat center center;
		                top: 50%; left: 50%;width: 30px;height:30px;">
		            </div>
		        </div>
		
		        <!-- Slides Container -->
		        <div u="slides" style="cursor: move; position: absolute; left: 0px; top: 0px; width: 450px; height: 350px; overflow: hidden;">
		        	{% for image in recipe.images.all %}
		            <div>
		            	<a href="#">
		                	<img class="recipe-image" u="image" src="{{ image.small_image.url }}" />
		                </a>
		                <img u="thumb" src="{{ image.thumbnail.url }}" />
		                {% if image.added_by == user or recipe.author == user %}
		                <a class="remove-image-button" href="{% url 'delete_recipe_image' image.id %}" title="Verwijder deze afbeelding" onclick="return confirm('Weet u zeker dat u deze afbeelding wil verwijderen?')"><img src="{{ STATIC_URL }}img/icons/delete.png" alt="" /></a>
		                {% endif %}
		            </div>
		            {% endfor %}
		        </div>
		        
		        <!-- Thumbnail Navigator Skin Begin -->
		        <div u="thumbnavigator" class="jssort01" style="position: absolute; width: 450px; height: 80px; left:0px; bottom: 0px;">
		        
		            <!-- Thumbnail Item Skin Begin -->
		            <div u="slides" style="cursor: move;">
		                <div u="prototype" class="p" style="position: absolute; width: 72px; height: 72px; top: 0; left: 0;">
		                    <div class=w><thumbnailtemplate style="width: 100%; height: 100%; border: none;position:absolute; top: 0; left: 0;"></thumbnailtemplate></div>
		                    <div class=c>
		                    </div>
		                </div>
		            </div>
		            <!-- Thumbnail Item Skin End -->
		        </div>
		        <!-- Thumbnail Navigator Skin End -->
		        <!-- Trigger -->
		        <script>
		            jssor_slider1_starter('recipe-images');
		        </script>
		    </div>
		    <br class="clear" />
		</div>
	</div>
	
	<div id="graphic-information-container">
		<div id="veganism" class="graphic-information-icon">
			{% if recipe.veganism == 2 %}
	    	<img src="{{ STATIC_URL }}img/icons/vegan.png" title="Dit is een veganistisch recept" alt="" />
	        {% elif recipe.veganism == 1 %}
	    	<img src="{{ STATIC_URL }}img/icons/vegetarian.png" title="Dit is een vegetarisch recept" alt="" />
	        {% elif recipe.veganism == 0 %}
	    	<img src="{{ STATIC_URL }}img/icons/non-vegetarian.png" title="Dit is een niet-vegetarisch recept" alt="" />
	    	{% endif %}
	    </div>
		<div id="fp-category" class="graphic-information-icon">
			<img src="{{ STATIC_URL }}img/decoration/{{ recipe.fp_category.get_ribbon_image_name }}" 
			     title="{{ recipe.fp_category.extra_info }}"/>
		</div>
		<div id="recipe-footprint" class="graphic-information-icon">
			<img src="{{ STATIC_URL }}img/decoration/footprint.png" title="Dit recept heeft een voetafdruk van {{ recipe.footprint|floatformat:2 }} kgCO&#8322; per portie."/>
			<span id="recipe-footprint-text" class="text-overlay" title="Dit recept heeft een voetafdruk van {{ recipe.footprint|floatformat:2 }} kgCO&#8322; per portie.">{{ recipe.footprint|floatformat:2 }}</span>
		</div>
		<div id="recipe-duration" class="graphic-information-icon">
			<img src="{{ STATIC_URL }}img/decoration/clock.png" />
			<span id="recipe-footprint-text" class="text-overlay" title="Dit recept duurt {{ recipe.total_preparation_time }} minuten om klaar te maken (waarvan je {{ recipe.active_time }} minuten actief bezig zal zijn).">{{ recipe.total_preparation_time }}</span>
		</div>
	</div>
		
	<div id="content-container" class="container">
    	{% block messages %}
        {% if messages %}
        <ul class="messages">
        	{% for message in messages %}
            <li class="{{ message.tags }}">
            	{{ message }}
            </li>
            {% endfor %}
		</ul>
        {% endif %}
        {% endblock %}
    </div>
        
    {% block content-wrapper %}
    {% block content %}
                
    <h2 class="ws-margin" style="margin-top: 20px;">
      	<span style="position:relative;">
       		IngrediÃ«nten
      		<div id="ingredients-loader" style="position:absolute;top:2px;right:-55px;height:50px;display:none;">
       			{% include "includes/ajax-loader.html" %}
       		</div>
       	</span>
       	
       	<span id="portions-changer">
       		<span>Porties</span>
       		<input type="number" value={{ recipe.portions }} min="1"/>
       	</span>
	</h2>
	        	
	<div id="ingredients">
		{% include "includes/ingredient_list.html" with usess=recipe.uses.all %}
	</div>
		        
	{% if recipe.extra_info %}
	<div id="extra-info" class="ws-margin">
		<h4>Extra info en benodigdheden</h4>
	    <p>
	       	{{ recipe.extra_info|linebreaks }}
	    </p>
	</div>
	{% endif %}
		        
		        
	<h2 class="ws-margin">
	   	Bereiding
	</h2>
		        
	<div id="instructions" class="ws-margin markdown-container">
		<div id="instructions-warning">
			Opgelet! De onderstaande instructies zijn opgesteld voor {{ recipe.portions }} porties. Je hebt het aantal porties aangepast waardoor het mogelijk
		    is dat deze instructies niet meer volledig accuraat zijn. Hou hier rekening mee.
		</div>
		{% if recipe.external %}
	</div>
	
	<div id="external-instructions">
		<a href="http://www.seasoning.be{% url 'external_recipe' recipe.id %}">
		 	<button type="submit">Bekijk het volledige recept op {{ recipe.external_site.name }}</button>
		</a>
		{% else %}
		<span itemprop="recipeInstructions">{{ recipe.instructions|markdown|safe }}</span>
	    {% endif %}
	</div>
	        
    <h2 class="ws-margin">Grafieken</h2>
                
    <div id="recipe-charts" class="ws-margin">
		<div id="chart-tabs">
	    	<ul>
	        	<li><a href="#tabs-1">Dynamiek</a></li>
	            <!-- <li><a href="#tabs-2">Verhoudingen</a></li>-->
	        </ul>
	        <div id="tabs-1">
	            <div id="recipe-fpevo-chart">            
	            	       
	            </div>
	        </div>
	        <!-- 
	        <div id="tabs-2">
	        	<div id="recipe-fprel-chart">
	                
	            </div>
	        </div>
	        -->
	    </div>
	        
		<div id="charts-ajax-loader">
		    {% include "includes/big-ajax-loader.html" %}
		</div>
	</div>
	        
    <h2 class="ws-margin">Reacties</h2>
	
	{% endblock %}
	{% endblock %}

{% endblock %}	
